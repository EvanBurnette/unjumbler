(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const L=Symbol("Comlink.proxy"),I=Symbol("Comlink.endpoint"),U=Symbol("Comlink.releaseProxy"),x=Symbol("Comlink.finalizer"),w=Symbol("Comlink.thrown"),T=e=>typeof e=="object"&&e!==null||typeof e=="function",V={canHandle:e=>T(e)&&e[L],serialize(e){const{port1:t,port2:r}=new MessageChannel;return C(e,t),[r,[r]]},deserialize(e){return e.start(),D(e)}},F={canHandle:e=>T(e)&&w in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},A=new Map([["proxy",V],["throw",F]]);function G(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function C(e,t=globalThis,r=["*"]){t.addEventListener("message",function s(n){if(!n||!n.data)return;if(!G(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:g,type:a,path:c}=Object.assign({path:[]},n.data),l=(n.data.argumentList||[]).map(y);let o;try{const i=c.slice(0,-1).reduce((u,p)=>u[p],e),f=c.reduce((u,p)=>u[p],e);switch(a){case"GET":o=f;break;case"SET":i[c.slice(-1)[0]]=y(n.data.value),o=!0;break;case"APPLY":o=f.apply(i,l);break;case"CONSTRUCT":{const u=new f(...l);o=B(u)}break;case"ENDPOINT":{const{port1:u,port2:p}=new MessageChannel;C(e,p),o=$(u,[u])}break;case"RELEASE":o=void 0;break;default:return}}catch(i){o={value:i,[w]:0}}Promise.resolve(o).catch(i=>({value:i,[w]:0})).then(i=>{const[f,u]=P(i);t.postMessage(Object.assign(Object.assign({},f),{id:g}),u),a==="RELEASE"&&(t.removeEventListener("message",s),W(t),x in e&&typeof e[x]=="function"&&e[x]())}).catch(i=>{const[f,u]=P({value:new TypeError("Unserializable return value"),[w]:0});t.postMessage(Object.assign(Object.assign({},f),{id:g}),u)})}),t.start&&t.start()}function q(e){return e.constructor.name==="MessagePort"}function W(e){q(e)&&e.close()}function D(e,t){return O(e,[],t)}function E(e){if(e)throw new Error("Proxy has been released and is not useable")}function _(e){return m(e,{type:"RELEASE"}).then(()=>{W(e)})}const k=new WeakMap,M="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(k.get(e)||0)-1;k.set(e,t),t===0&&_(e)});function v(e,t){const r=(k.get(t)||0)+1;k.set(t,r),M&&M.register(e,t,e)}function Y(e){M&&M.unregister(e)}function O(e,t=[],r=function(){}){let s=!1;const n=new Proxy(r,{get(g,a){if(E(s),a===U)return()=>{Y(n),_(e),s=!0};if(a==="then"){if(t.length===0)return{then:()=>n};const c=m(e,{type:"GET",path:t.map(l=>l.toString())}).then(y);return c.then.bind(c)}return O(e,[...t,a])},set(g,a,c){E(s);const[l,o]=P(c);return m(e,{type:"SET",path:[...t,a].map(i=>i.toString()),value:l},o).then(y)},apply(g,a,c){E(s);const l=t[t.length-1];if(l===I)return m(e,{type:"ENDPOINT"}).then(y);if(l==="bind")return O(e,t.slice(0,-1));const[o,i]=z(c);return m(e,{type:"APPLY",path:t.map(f=>f.toString()),argumentList:o},i).then(y)},construct(g,a){E(s);const[c,l]=z(a);return m(e,{type:"CONSTRUCT",path:t.map(o=>o.toString()),argumentList:c},l).then(y)}});return v(n,e),n}function X(e){return Array.prototype.concat.apply([],e)}function z(e){const t=e.map(P);return[t.map(r=>r[0]),X(t.map(r=>r[1]))]}const N=new WeakMap;function $(e,t){return N.set(e,t),e}function B(e){return Object.assign(e,{[L]:!0})}function P(e){for(const[t,r]of A)if(r.canHandle(e)){const[s,n]=r.serialize(e);return[{type:"HANDLER",name:t,value:s},n]}return[{type:"RAW",value:e},N.get(e)||[]]}function y(e){switch(e.type){case"HANDLER":return A.get(e.name).deserialize(e.value);case"RAW":return e.value}}function m(e,t,r){return new Promise(s=>{const n=J();e.addEventListener("message",function g(a){!a.data||!a.data.id||a.data.id!==n||(e.removeEventListener("message",g),s(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function J(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const K=(e,t)=>{for(const r in e)if(!(r in t)||e[r]!==t[r])return!1;return Object.keys(e).length==Object.keys(t).length},Q=(e,t)=>{for(const r in e)if(e[r]>t[r])return!1;return!0};let j=[],S=[];const Z=e=>{j=e.split(`
`),ee(),console.debug(S.slice(0,10))},H=e=>{const t={};for(const r of e)t[r]?t[r]++:t[r]=1;return t},ee=()=>{S=j.map(e=>({word:e,counts:H(e)}))},te=e=>{const t=H(e);return S.filter(r=>K(r.counts,t)).map(r=>r.word)},re=navigator.hardwareConcurrency;let d=navigator.maxTouchPoints>0?2:Math.max(2,Math.floor(re/2));const ne=e=>{d=e},se=()=>d,b=[];for(let e=0;e<d;e++){const t=D(new Worker(new URL(""+new URL("subWorker-02e1cc52.js",self.location.href).href,self.location)));t.setWorkerId(e),b.push(t)}console.debug("hello from main worker");let h,R;var ae=Object.freeze({__proto__:null,getNumSubworkers:se,getPhrases:e=>{d>h[0].length?b[0]._getPhrases(R,[],e,h):b.forEach((t,r)=>{const s={start:r*Math.floor(h[0].length/d),end:(r+1)*Math.floor(h[0].length/d)};r===b.length-1&&(s.end=h[0].length+1);const n=structuredClone(h);n[0]=n[0].slice(s.start,s.end),b[r]._getPhrases(R,[],e,n)})},getWords:te,setConcurrency:ne,setDictionary:Z,setupData:(e,t)=>{R=e,new Set(Object.entries(e).filter(([r,s])=>s>0).map(([r,s])=>r)),h=t.map(r=>S.filter(({word:s,counts:n})=>r!==s.length?!1:Q(n,e)))}});C(ae)})();
